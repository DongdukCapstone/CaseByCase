<!DOCTYPE html>
<html
      lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout}"
      th:charset="UTF-8">
<head>
    <meta charset="UTF-8" />
    <title>Case by Case</title>
    <meta name="viewport" content="width=device-width, maximum-scale=1.0, minimum-scale=1, user-scalable=yes,initial-scale=1.0" />

    <link rel="stylesheet" th:href="@{/css/session1.css}" />
    <!-- content script -->
    <th:block layout:fragment="script"></th:block>
</head>

<th:block layout:fragment="content">
    <div class="content">
        <div class="testtitle">
            <p class="title" id="test1">PART 1</p>
        </div>
        <div class="N01_1">
            <p>1. 원하는 카테고리를 선택하시오.</p>
            <form th:action="@{/casebycase/submitCategory}" method="post">
                <label for="category"> 카데고리 선택:</label>
                <select id="category" name="category">
                    <option value="애니메이션">애니메이션</option>
                    <option value="패션">패션</option>
                    <option value="모던">모던</option>
                    <option value="게임">게임</option>
                    <option value="아티스틱">아티스틱</option>
                    <option value="그래픽">그래픽</option>
                    <option value="Y2K">Y2K</option>
                </select>
                    <button type="submit" id="submitButton">선택</button>

            <br>

            <div class="question2">
                <p class="question2_p">2. 마음에 드는 이미지 3장을 선택하시오.</p>
                <button type="submit">다른 이미지 보기</button>
            </div>
            </form>
        <form>
        <div class="sel_category" th:fragment="imageList">
            <th:block th:if="${selectedCategory}">
                <div class="image-box" th:each="image : ${randomImages}">
                    <img th:src="@{'/images/' + ${fileName} + '/' + ${image}}" alt="랜덤 이미지">
                <div>
                <input type="checkbox" th:id="${'checkbox-' + image}" class="image-checkbox">
                <label th:for="${'checkbox-' + image}" th:text="${image}" class="image-name"></label>
                </div>
                </div>
            </th:block>
            <br>
        </div>
            <button type="button" onclick="submitSelectedImages()">이미지 선택하기</button>
        </form>

        </div>
        <div class="N02_1">
            <p>3. 사용자께서 평소 이용한 휴대폰 케이스 사진을 업로드 해주세요.</p>
            <form th:action="@{/uploadImage}" method="post" enctype="multipart/form-data" th:object="${uploadForm}">
                <input type="file" name="file" accept="image/*" />
                <button type="submit">업로드</button>
            </form>
        </div>
        <div class="testtitle">
            <p class="title" id="test2">PART 2</p>
        </div>
        <div class="N01_2">
            <p>1. 원하는 카테고리를 선택하시오.</p>
            <form th:action="@{/submitCategory2}" method="post">
                <label for="category2"> 카데고리 선택:</label>
                <select id="category2" name="category">
                    <option value="애니메이션">에니메이션</option>
                    <option value="패션">패션</option>
                    <option value="모던">모던</option>
                    <option value="게임">게임</option>
                    <option value="아티스틱">아티스틱</option>
                    <option value="그래픽">그래픽</option>
                    <option value="Y2K">Y2K</option>
                </select>
                <button type="submit">선택</button>
            </form>
        </div>
        <!-- 이미지 업로드 -->
        <br>
        <div class="N02_2">
            <p class="question2_p">2. 사용자께서 사용한 휴대폰 케이스를 업로드 해주세요.</p>
        <form th:action="@{/uploadImage}" method="post" enctype="multipart/form-data" th:object="${uploadForm}">
            <input type="file" name="file" accept="image/*" />
            <button type="submit">업로드</button>
        </form>

        <form>
        <div class="sel_category">

<!--
            <th:block th:unless="${selectedCategory2}">
                &lt;!&ndash; 선택되지 않았을 때는 빈 네모박스 표시 &ndash;&gt;
                <th:block th:each="i : ${#numbers.sequence(1, 10)}">
                    <div class="image-box empty-box"></div>
                </th:block>
            </th:block>
-->

            <th:block th:if="${selectedCategory2}">
                <th:block th:each="i : ${#numbers.sequence(1, 10)}">
                    <!-- 이미지를 표시하는 부분 -->
                    <div class="image-box">

                    </div>
                </th:block>
            </th:block>
            <br>
        </div>
            <button type="button" onclick="submitSelectedImages()">이미지 선택하기</button>
        </form>
        </div>
    </div>


    <script th:inline="javascript">

        document.addEventListener('DOMContentLoaded', function () {
            // 페이지 로드 시 실행되는 부분

            // 서버에서 받아온 카테고리 값을 가져와서 표시
            var selectedCategory = /*[[${selectedCategory}]]*/ '';
            setCategorySelection(selectedCategory);
        });

        function setCategorySelection(category) {
            // 선택한 카테고리를 옵션으로 설정
            var categorySelect = document.getElementById('category');
            if (categorySelect) {
                for (var i = 0; i < categorySelect.options.length; i++) {
                    if (categorySelect.options[i].value === category) {
                        categorySelect.selectedIndex = i;
                        break;
                    }
                }
            }
        }

        // 카테고리 폼을 제출할 때 실행되는 함수
        document.getElementById('categoryForm').addEventListener('submit', function (event) {
            event.preventDefault(); // 기본 동작을 막음

            // 서버로 폼을 제출
            this.submit();
        });

        //체크박스 3개까지만 선택 가능

        document.addEventListener('DOMContentLoaded', function () {
        var checkboxes = document.querySelectorAll('.image-checkbox');
        var maxAllowed = 3;

        checkboxes.forEach(function (checkbox) {
            checkbox.addEventListener('change', function () {
                var checkedCheckboxes = document.querySelectorAll('.image-checkbox:checked');

                if (checkedCheckboxes.length > maxAllowed) {
                    this.checked = false;
                }
            });
        });
    });

    </script>
    </th:block>


    </html>